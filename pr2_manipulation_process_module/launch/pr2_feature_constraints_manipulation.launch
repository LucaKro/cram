<launch>
  <!-- LOAD VELOCITY-RESOLVED ARM CONTROLLERS IN STOPPED STATE -->
  <include file="$(find ias_mechanism_controllers)/launch/pr2_multi_vel_load.launch"/>

  <!-- LOAD FILTER PARAMETERS FOR CONSTRAINT VELOCITY ESTIMATION -->
  <rosparam command="load" ns="/left_arm_feature_controller" file="$(find feature_constraints_standalone)/launch/constraint_velocity_filter_chain_params.yaml"/>
  <rosparam command="load" ns="/right_arm_feature_controller" file="$(find feature_constraints_standalone)/launch/constraint_velocity_filter_chain_params.yaml"/>

  <!-- START UP FEATURE CONTROLLERS WITH TOPIC REMAPS -->
  <node name="left_arm_feature_controller" launch-prefix="xterm -e gdb -ex run -args" type="constraint_controller" pkg="feature_constraints_standalone" output="screen">
    <param name="~tool_frame" value="l_gripper_tool_frame"/> <!-- refactor into 'arm_tool_frame' -->
    <param name="~robot_base_frame" value="base_link"/>
    <param name="~map_frame" value="base_link"/>
    <param name="~base_frame" value="torso_lift_link"/> <!-- refactor into 'arm_base_frame' -->
    <param name="~joint_limit_avoidance" value="true"/>
    <remap from="~qdot" to="/l_arm_vel/command"/>
  </node>

  <node name="right_arm_feature_controller" launch-prefix="xterm -e gdb -ex run -args" type="constraint_controller" pkg="feature_constraints_standalone" output="screen">
    <param name="~tool_frame" value="r_gripper_tool_frame"/> <!-- refactor into 'arm_tool_frame' -->
    <param name="~robot_base_frame" value="base_link"/>
    <param name="~map_frame" value="base_link"/>
    <param name="~base_frame" value="torso_lift_link"/> <!-- refactor into 'arm_base_frame' -->
    <param name="~joint_limit_avoidance" value="true"/>
    <remap from="~qdot" to="/r_arm_vel/command"/>
  </node>

  <!-- START UP RVIZ VISUALIZATION OF OBJECT MODELS FOR PANCAKE FLIPPING -->
  <!-- spatula models -->
  <node name="l_spatula_model" pkg="itasc" type="spatula_model_bremen_1.py" args="http://ias.cs.tum.edu/kb/spatula-features.owl#Spatula_LvaYsvy6"/>
  <node name="r_spatula_model" pkg="itasc" type="spatula_model_bremen_1.py" args="http://ias.cs.tum.edu/kb/spatula-features.owl#Spatula_Rkpqmqf1"/>
  <!-- table model with oven -->
  <!-- node name="baker_model" pkg="itasc" type="baker_model.py" args="/table" -->
  <!-- publish extra frame from pancake to to oven -->

  <!-- START UP FEATURE VISUALIZATION -->
  <node name="left_feature_viz" pkg="feature_constraints_utils" type="feature_viz.py" output="screen">
    <param name="~base_frame" value="/http://ias.cs.tum.edu/kb/spatula-features.owl#Pancake_PjkWnkr1"/>
    <remap from="constraint_config" to="/left_arm_feature_controller/constraint_config"/>
  </node>
  <node name="right_feature_viz" pkg="feature_constraints_utils" type="feature_viz.py" output="screen">
    <param name="~base_frame" value="/http://ias.cs.tum.edu/kb/spatula-features.owl#Pancake_PjkWnkr1"/>
    <remap from="constraint_config" to="/right_arm_feature_controller/constraint_config"/>
  </node>

</launch>
